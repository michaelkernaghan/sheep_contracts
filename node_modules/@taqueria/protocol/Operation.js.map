{"version":3,"sources":["Operation.ts"],"sourcesContent":["import createType, { Flatten } from '@taqueria/protocol/Base';\nimport * as Command from '@taqueria/protocol/Command';\nimport * as Option from '@taqueria/protocol/Option';\nimport * as PersistentState from '@taqueria/protocol/PersistentState';\nimport * as PositionalArg from '@taqueria/protocol/PositionalArg';\nimport * as RequestArgs from '@taqueria/protocol/RequestArgs';\nimport * as Verb from '@taqueria/protocol/Verb';\nimport { z } from 'zod';\n\ntype Handler = (state: PersistentState.t) => <T extends RequestArgs.t>(opts: T) => unknown;\n\nexport const rawSchema = z.object({\n\toperation: Verb.rawSchema.describe('Operation Name'),\n\tcommand: Command.rawSchema.describe('Operation Command'),\n\tdescription: z.string({ description: 'Operation Description' }).optional(),\n\tpositionals: z.array(PositionalArg.rawSchema).default([]).describe('Operation Positional Args').optional(),\n\toptions: z.preprocess(\n\t\t(val: unknown) => val ?? [],\n\t\tz.array(\n\t\t\tOption.rawSchema.describe('Operation Option'),\n\t\t\t{ description: 'Operation Options' },\n\t\t).optional(),\n\t),\n\thandler: z.function()\n\t\t.args(PersistentState.rawSchema)\n\t\t.returns(\n\t\t\tz.function()\n\t\t\t\t.args(RequestArgs.schemas.internalSchema),\n\t\t)\n\t\t.describe('Operation Handler')\n\t\t.transform((val: unknown) => val as Handler),\n}).describe('Operation');\n\nexport const internalSchema = z.object({\n\toperation: Verb.schemas.schema.describe('Operation Name'),\n\tcommand: Command.schemas.schema.describe('Operation Command'),\n\tdescription: z.string({ description: 'Optionation Description' }).optional(),\n\tpositionals: z.array(PositionalArg.schemas.schema).default([]).describe('Operation Positional Args').optional(),\n\toptions: z.preprocess(\n\t\t(val: unknown) => val ?? [] as Option.t[],\n\t\tz.array(Option.schemas.schema.describe('Operation Option'), { description: 'Operation Options' }).optional(),\n\t),\n\thandler: z.function()\n\t\t.args(PersistentState.rawSchema)\n\t\t.returns(\n\t\t\tz.function()\n\t\t\t\t.args(RequestArgs.schemas.schema),\n\t\t)\n\t\t.describe('Operation Handler')\n\t\t.transform((val: unknown) => val as Handler),\n}).describe('Operation');\n\ntype Input = Flatten<z.infer<typeof internalSchema>>;\ntype RawInput = z.infer<typeof rawSchema>;\n\nexport const { schemas: generatedSchemas, factory } = createType<RawInput, Input>({\n\trawSchema,\n\tinternalSchema,\n\tparseErrMsg: (value: unknown) => `The following operation is invalid: ${value}`,\n\tunknownErrMsg: 'Something went wrong trying to parse the operation',\n});\n\nexport type Operation = Flatten<z.infer<typeof generatedSchemas.schema>>;\nexport type t = Operation;\nexport const { make, of, create } = factory;\n\nexport const schemas = {\n\t...generatedSchemas,\n\tschema: generatedSchemas.schema.transform(val => val as Operation),\n};\n"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAAAA;AAAA,EAAA,eAAAC;AAAA;AAAA;AAAA,kBAAoC;AACpC,cAAyB;AACzB,aAAwB;AACxB,sBAAiC;AACjC,oBAA+B;AAC/B,kBAA6B;AAC7B,WAAsB;AACtB,iBAAkB;AAIX,IAAMD,aAAY,aAAE,OAAO;AAAA,EACjC,WAAgB,eAAU,SAAS,gBAAgB;AAAA,EACnD,SAAiB,kBAAU,SAAS,mBAAmB;AAAA,EACvD,aAAa,aAAE,OAAO,EAAE,aAAa,wBAAwB,CAAC,EAAE,SAAS;AAAA,EACzE,aAAa,aAAE,MAAoB,uBAAS,EAAE,QAAQ,CAAC,CAAC,EAAE,SAAS,2BAA2B,EAAE,SAAS;AAAA,EACzG,SAAS,aAAE;AAAA,IACV,CAAC,QAAiB,OAAO,CAAC;AAAA,IAC1B,aAAE;AAAA,MACM,iBAAU,SAAS,kBAAkB;AAAA,MAC5C,EAAE,aAAa,oBAAoB;AAAA,IACpC,EAAE,SAAS;AAAA,EACZ;AAAA,EACA,SAAS,aAAE,SAAS,EAClB,KAAqB,yBAAS,EAC9B;AAAA,IACA,aAAE,SAAS,EACT,KAAiB,oBAAQ,cAAc;AAAA,EAC1C,EACC,SAAS,mBAAmB,EAC5B,UAAU,CAAC,QAAiB,GAAc;AAC7C,CAAC,EAAE,SAAS,WAAW;AAEhB,IAAM,iBAAiB,aAAE,OAAO;AAAA,EACtC,WAAgB,aAAQ,OAAO,SAAS,gBAAgB;AAAA,EACxD,SAAiB,gBAAQ,OAAO,SAAS,mBAAmB;AAAA,EAC5D,aAAa,aAAE,OAAO,EAAE,aAAa,0BAA0B,CAAC,EAAE,SAAS;AAAA,EAC3E,aAAa,aAAE,MAAoB,sBAAQ,MAAM,EAAE,QAAQ,CAAC,CAAC,EAAE,SAAS,2BAA2B,EAAE,SAAS;AAAA,EAC9G,SAAS,aAAE;AAAA,IACV,CAAC,QAAiB,OAAO,CAAC;AAAA,IAC1B,aAAE,MAAa,eAAQ,OAAO,SAAS,kBAAkB,GAAG,EAAE,aAAa,oBAAoB,CAAC,EAAE,SAAS;AAAA,EAC5G;AAAA,EACA,SAAS,aAAE,SAAS,EAClB,KAAqB,yBAAS,EAC9B;AAAA,IACA,aAAE,SAAS,EACT,KAAiB,oBAAQ,MAAM;AAAA,EAClC,EACC,SAAS,mBAAmB,EAC5B,UAAU,CAAC,QAAiB,GAAc;AAC7C,CAAC,EAAE,SAAS,WAAW;AAKhB,IAAM,EAAE,SAAS,kBAAkB,QAAQ,QAAI,YAAAE,SAA4B;AAAA,EACjF,WAAAF;AAAA,EACA;AAAA,EACA,aAAa,CAAC,UAAmB,uCAAuC;AAAA,EACxE,eAAe;AAChB,CAAC;AAIM,IAAM,EAAE,MAAM,IAAI,OAAO,IAAI;AAE7B,IAAMC,WAAU;AAAA,EACtB,GAAG;AAAA,EACH,QAAQ,iBAAiB,OAAO,UAAU,SAAO,GAAgB;AAClE;","names":["rawSchema","schemas","createType"]}