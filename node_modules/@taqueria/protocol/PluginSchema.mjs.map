{"version":3,"sources":["PluginSchema.ts"],"sourcesContent":["import * as Alias from '@taqueria/protocol/Alias';\nimport createType from '@taqueria/protocol/Base';\nimport * as Operation from '@taqueria/protocol/Operation';\nimport * as PluginDependenciesResponse from '@taqueria/protocol/PluginDependenciesResponse';\nimport * as PluginInfo from '@taqueria/protocol/PluginInfo';\nimport * as PluginProxyResponse from '@taqueria/protocol/PluginProxyResponse';\nimport * as RequestArgs from '@taqueria/protocol/RequestArgs';\nimport * as Template from '@taqueria/protocol/Template';\nimport { z } from 'zod';\n\nconst proxyFnSchema = z\n\t.function()\n\t.args(RequestArgs.proxySchemas.schema)\n\t.returns(z.promise(PluginProxyResponse.schemas.schema));\n\nconst runtimeDependenciesFn = z\n\t.function()\n\t.args(RequestArgs.schemas.schema)\n\t.returns(z.promise(PluginDependenciesResponse.schemas.schema));\n\nconst internalSchema = PluginInfo.internalSchema.extend({\n\toperations: z.preprocess(\n\t\tval => val ?? [],\n\t\tz.array(\n\t\t\tOperation.schemas.schema,\n\t\t\t{ description: 'ParsedOperations' },\n\t\t)\n\t\t\t.optional(),\n\t),\n\ttemplates: z.preprocess(\n\t\tval => val ?? [],\n\t\tz.array(\n\t\t\tTemplate.schemas.schema,\n\t\t).optional(),\n\t),\n\tproxy: proxyFnSchema.optional(),\n\tcheckRuntimeDependencies: runtimeDependenciesFn.optional(),\n\tinstallRuntimeDependencies: runtimeDependenciesFn.optional(),\n}).describe('ParsedPluginInfo');\n\nexport const rawSchema = PluginInfo.rawSchema.extend({\n\tname: Alias.rawSchema.optional(),\n\toperations: z.preprocess(\n\t\tval => val ?? [],\n\t\tz.array(\n\t\t\tOperation.rawSchema,\n\t\t\t{ description: 'ParsedOperation' },\n\t\t),\n\t)\n\t\t.optional(),\n\ttemplates: z.preprocess(\n\t\tval => val ?? [],\n\t\tz.array(\n\t\t\tTemplate.schemas.schema,\n\t\t).optional(),\n\t),\n\tproxy: proxyFnSchema.optional(),\n\tcheckRuntimeDependencies: runtimeDependenciesFn.optional(),\n\tinstallRuntimeDependencies: runtimeDependenciesFn.optional(),\n}).describe('ParsedPluginInfo');\n\ntype Input = z.infer<typeof internalSchema>;\n\nexport type RawPluginSchema = z.infer<typeof rawSchema>;\n\nexport const { schemas: generatedSchemas, factory } = createType<RawPluginSchema, Input>({\n\trawSchema,\n\tinternalSchema,\n\tparseErrMsg: (value: unknown) =>\n\t\t`The following plugin info gave us trouble when parsing the following plugin information: ${value}`,\n\tunknownErrMsg: 'Something went wrong trying to parse the plugin information',\n});\n\nexport type ParsedPluginInfo = z.infer<typeof generatedSchemas.schema>;\nexport type t = ParsedPluginInfo;\nexport const { create, of, make } = factory;\n\nexport const schemas = {\n\t...generatedSchemas,\n\tschema: generatedSchemas.schema.transform(val => val as ParsedPluginInfo),\n};\n"],"mappings":";AAAA,YAAY,WAAW;AACvB,OAAO,gBAAgB;AACvB,YAAY,eAAe;AAC3B,YAAY,gCAAgC;AAC5C,YAAY,gBAAgB;AAC5B,YAAY,yBAAyB;AACrC,YAAY,iBAAiB;AAC7B,YAAY,cAAc;AAC1B,SAAS,SAAS;AAElB,IAAM,gBAAgB,EACpB,SAAS,EACT,KAAiB,yBAAa,MAAM,EACpC,QAAQ,EAAE,QAA4B,4BAAQ,MAAM,CAAC;AAEvD,IAAM,wBAAwB,EAC5B,SAAS,EACT,KAAiB,oBAAQ,MAAM,EAC/B,QAAQ,EAAE,QAAmC,mCAAQ,MAAM,CAAC;AAE9D,IAAMA,kBAA4B,0BAAe,OAAO;AAAA,EACvD,YAAY,EAAE;AAAA,IACb,SAAO,OAAO,CAAC;AAAA,IACf,EAAE;AAAA,MACS,kBAAQ;AAAA,MAClB,EAAE,aAAa,mBAAmB;AAAA,IACnC,EACE,SAAS;AAAA,EACZ;AAAA,EACA,WAAW,EAAE;AAAA,IACZ,SAAO,OAAO,CAAC;AAAA,IACf,EAAE;AAAA,MACQ,iBAAQ;AAAA,IAClB,EAAE,SAAS;AAAA,EACZ;AAAA,EACA,OAAO,cAAc,SAAS;AAAA,EAC9B,0BAA0B,sBAAsB,SAAS;AAAA,EACzD,4BAA4B,sBAAsB,SAAS;AAC5D,CAAC,EAAE,SAAS,kBAAkB;AAEvB,IAAMC,aAAuB,qBAAU,OAAO;AAAA,EACpD,MAAY,gBAAU,SAAS;AAAA,EAC/B,YAAY,EAAE;AAAA,IACb,SAAO,OAAO,CAAC;AAAA,IACf,EAAE;AAAA,MACS;AAAA,MACV,EAAE,aAAa,kBAAkB;AAAA,IAClC;AAAA,EACD,EACE,SAAS;AAAA,EACX,WAAW,EAAE;AAAA,IACZ,SAAO,OAAO,CAAC;AAAA,IACf,EAAE;AAAA,MACQ,iBAAQ;AAAA,IAClB,EAAE,SAAS;AAAA,EACZ;AAAA,EACA,OAAO,cAAc,SAAS;AAAA,EAC9B,0BAA0B,sBAAsB,SAAS;AAAA,EACzD,4BAA4B,sBAAsB,SAAS;AAC5D,CAAC,EAAE,SAAS,kBAAkB;AAMvB,IAAM,EAAE,SAAS,kBAAkB,QAAQ,IAAI,WAAmC;AAAA,EACxF,WAAAA;AAAA,EACA,gBAAAD;AAAA,EACA,aAAa,CAAC,UACb,4FAA4F;AAAA,EAC7F,eAAe;AAChB,CAAC;AAIM,IAAM,EAAE,QAAQ,IAAI,KAAK,IAAI;AAE7B,IAAME,WAAU;AAAA,EACtB,GAAG;AAAA,EACH,QAAQ,iBAAiB,OAAO,UAAU,SAAO,GAAuB;AACzE;","names":["internalSchema","rawSchema","schemas"]}